

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Horizon 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Training a model across multiple GPUs" href="distributed.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Horizon
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#on-policy-rl-training">1 - On-Policy RL Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#offline-rl-training-batch-rl">2- Offline RL Training (Batch RL)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-create-training-data">Step 1 - Create training data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-convert-the-data-to-the-timeline-format">Step 2 - Convert the data to the <code class="docutils literal notranslate"><span class="pre">timeline</span></code> format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-create-the-normalization-parameters">Step 3 - Create the normalization parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-train-model">Step 4 - Train model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-evaluate-the-model">Step 5 - Evaluate the Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-visualize-results-via-tensorboard">Step 6 - Visualize Results via Tensorboard</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">Distributed Training</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/ml.rl.workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ml.rl.preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ml.rl.simulators.html">Simulators</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ml.rl.thrift.html">Thrift</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ml.rl.training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">All Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/facebookresearch/ReAgent">Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Horizon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<span id="id1"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>Horizon is designed for large-scale, distributed recommendation/optimization tasks where we don’t
have access to a simulator.  In this environment, it’s typically better to train offline on batches
of data, and release new policies slowly over time.  Because the policy updates slowly and in
batches, we use <em>off-policy</em> algorithms.  To test a new policy without deploying it, we rely on
<em>counter-factual policy evaluation (CPE)</em>, a set of techniques for estimating a policy based on the
actions of another policy.</p>
<p>Before we get started using Horizon as it is intended, let’s begin with a traditional RL setup with a simulator where we can trivially evaluate new policies:</p>
<div class="section" id="on-policy-rl-training">
<h2>1 - On-Policy RL Training<a class="headerlink" href="#on-policy-rl-training" title="Permalink to this headline">¶</a></h2>
<p>Open AI Gym is a set of environments: simulators that can run policies for a given task and generate rewards.  If a simulator is accessible, on-policy training (where the latest version of the policy makes new decisions in real-time) can give better results. To train a model on OpenAI Gym, simply run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">gym</span><span class="o">/</span><span class="n">run_gym</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">gym</span><span class="o">/</span><span class="n">discrete_dqn_cartpole_v0</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Configs for different environments and algorithms can be found in <code class="docutils literal notranslate"><span class="pre">ml/rl/test/gym/</span></code>.</p>
<p>While this is typically the set up for people conducting RL research, it isn’t always practical to deploy on-policy RL for several reasons:</p>
<ol class="arabic simple">
<li><p>We don’t have a simulator and the problem may be so complex that building an accurate simulator is non-trivial.</p></li>
<li><p>Thousands or even tens-of-thousands of machines must execute the policy in parallel, and keeping the latest policy in sync on all of these nodes is difficult</p></li>
<li><p>We want to evaluate the behavior of the policy offline and then keep the policy constant afterwards to reduce the risk that the policy will degrade at odd hours.</p></li>
<li><p>We are building on top of traditional recommender systems that typically rely on a fixed, stochastic policy.</p></li>
</ol>
<p>For these reasons, Horizon is designed to support batch, off-policy RL.  Let’s now walk though how to train a model with Horizon:</p>
</div>
<div class="section" id="offline-rl-training-batch-rl">
<h2>2- Offline RL Training (Batch RL)<a class="headerlink" href="#offline-rl-training-batch-rl" title="Permalink to this headline">¶</a></h2>
<p>The main use case of Horizon is to train RL models in the <strong>batch</strong> setting. In batch reinforcement learning the data collection and policy learning steps are decoupled. Specifically, we try to learn the best possible policy given the input data. In batch RL, being able to handle thousands of varying feature types and distributions and algorithm performance estimates before deployment are of key importance.</p>
<p>In this example, we will train a DQN model on Offline <code class="docutils literal notranslate"><span class="pre">Cartpole-v0</span></code> data:</p>
<div class="section" id="step-1-create-training-data">
<h3>Step 1 - Create training data<a class="headerlink" href="#step-1-create-training-data" title="Permalink to this headline">¶</a></h3>
<p>First we need to generate the data required to train our RL models. For this example we generate data from the <code class="docutils literal notranslate"><span class="pre">Cartpole-v0</span></code> environment in OpenAI Gym. In practice, end users would generate a dataset in a similar format from their production system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">cartpole_discrete</span>

<span class="n">python</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">gym</span><span class="o">/</span><span class="n">run_gym</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">gym</span><span class="o">/</span><span class="n">discrete_dqn_cartpole_v0</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">f</span> <span class="n">cartpole_discrete</span><span class="o">/</span><span class="n">training_data</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Let’s look at one row of data to see the expected input format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">cartpole_discrete</span><span class="o">/</span><span class="n">training_data</span><span class="o">.</span><span class="n">json</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="n">n1</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">json</span><span class="o">.</span><span class="n">tool</span>

<span class="p">{</span>
    <span class="s2">&quot;mdp_id&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sequence_number&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;state_features&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">0.0021880944</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.015781501</span><span class="p">,</span>
        <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.031933542</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="mf">0.04611974</span>
    <span class="p">},</span>
    <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;possible_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;action_probability&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="s2">&quot;ds&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-06-25&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The input data is a flat file containing a JSON object per-line separated by newlines (the first line is pretty-printed here for readability).  This is human-readable, but not the most efficient way to store tabular data.  Other ways to store input data is parquet, CSV, or any other format that can be read by Apache Spark.  All of these formats are fine, as long as the following schema is maintained:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mdp_id</p></td>
<td><p>string</p></td>
<td><p>A unique ID for the episode (e.g. an entire playthrough of a game)</p></td>
</tr>
<tr class="row-odd"><td><p>sequence_number</p></td>
<td><p>integer</p></td>
<td><p>Defines the ordering of states in an MDP (e.g. the timestamp of an event)</p></td>
</tr>
<tr class="row-even"><td><p>state_features</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map&lt;integer,float&gt;</span></code></p></td>
<td><p>A set of features describing the state.</p></td>
</tr>
<tr class="row-odd"><td><p>action</p></td>
<td><p>string</p></td>
<td><p>The name of the action chosen</p></td>
</tr>
<tr class="row-even"><td><p>reward</p></td>
<td><p>float</p></td>
<td><p>The reward at this state/action</p></td>
</tr>
<tr class="row-odd"><td><p>possible_actions</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></p></td>
<td><p>A list of all possible actions at this state.  Note that the action taken must be present in this list.</p></td>
</tr>
<tr class="row-even"><td><p>action_probability</p></td>
<td><p>float</p></td>
<td><p>The probability of taking this action if the policy is stochastic, else <code class="docutils literal notranslate"><span class="pre">null</span></code>.  Note that we strongly encourage using a stochastic policy instead of choosing the best action at every timestep.  This exploration will improve the evaluation and ultimately result in better learned policies.</p></td>
</tr>
<tr class="row-odd"><td><p>ds</p></td>
<td><p>string</p></td>
<td><p>A unique ID for this dataset.</p></td>
</tr>
</tbody>
</table>
<p>Note that JSON does not support integer keys in objects so in our JSON format we replace the <code class="docutils literal notranslate"><span class="pre">map&lt;integer,float&gt;</span></code> with <code class="docutils literal notranslate"><span class="pre">map&lt;string,float&gt;</span></code>, but even in this case the keys must be strings of integers.</p>
<p>Once you have data on this format (or you have generated data using our gym script) you can move on to step 2:</p>
</div>
<div class="section" id="step-2-convert-the-data-to-the-timeline-format">
<h3>Step 2 - Convert the data to the <code class="docutils literal notranslate"><span class="pre">timeline</span></code> format<a class="headerlink" href="#step-2-convert-the-data-to-the-timeline-format" title="Permalink to this headline">¶</a></h3>
<p>Models are trained on consecutive pairs of state/action tuples. To assist in creating this table, we have an <code class="docutils literal notranslate"><span class="pre">RLTimelineOperator</span></code> spark operator. Let’s build and run the timeline operator on the data:</p>
<p>First, we need to build the Spark library that will execute the timeline.  Apache Spark is a platform for doing massively-parallel processing.  Although we are running this on a single file, Spark is designed to work on thousands of files distribued across many machines.  Explaining HDFS, Hive, and Spark are beyond the scope of this tutorial, but for large datasets it’s important to understand these concepts and that it’s possible to run Horizon in a distributed environment by simply changing the location of the input from a file to an HDFS folder.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build timeline package (only need to do this first time)</span>
<span class="n">mvn</span> <span class="o">-</span><span class="n">f</span> <span class="n">preprocessing</span><span class="o">/</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span> <span class="n">clean</span> <span class="n">package</span>
</pre></div>
</div>
<p>When running spark locally, spark creates a fake “cluster” where it stores all of the data.  We want to remove this before running so we don’t accidentally pull in data from a prior run.  In a production setting, we would delete the output data table before running using a Hive command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clear last run&#39;s spark data (in case of interruption)</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">spark</span><span class="o">-</span><span class="n">warehouse</span> <span class="n">derby</span><span class="o">.</span><span class="n">log</span> <span class="n">metastore_db</span> <span class="n">preprocessing</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">warehouse</span> <span class="n">preprocessing</span><span class="o">/</span><span class="n">metastore_db</span> <span class="n">preprocessing</span><span class="o">/</span><span class="n">derby</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Now that we are ready, let’s run our spark job on our local machine.  This will produce a massive amount of logging (because we are running many systems that typically are distributed across many nodes) and there will be some exception stack traces printed because we are running in a psuedo-distributed mode.  Generally this is fine as long as the output data is generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run timelime on pre-timeline data</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">spark</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">submit</span> \
  <span class="o">--</span><span class="k">class</span> <span class="nc">com</span><span class="o">.</span><span class="n">facebook</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">rl</span><span class="o">.</span><span class="n">Preprocessor</span> <span class="n">preprocessing</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">rl</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">-</span><span class="mf">1.1</span><span class="o">.</span><span class="n">jar</span> \
  <span class="s2">&quot;`cat ml/rl/workflow/sample_configs/discrete_action/timeline.json`&quot;</span>

<span class="c1"># Look at the first row of training &amp; eval</span>
<span class="n">head</span> <span class="o">-</span><span class="n">n1</span> <span class="n">cartpole_discrete_training</span><span class="o">/</span><span class="n">part</span><span class="o">*</span>

<span class="n">head</span> <span class="o">-</span><span class="n">n1</span> <span class="n">cartpole_discrete_eval</span><span class="o">/</span><span class="n">part</span><span class="o">*</span>
</pre></div>
</div>
<p>There are many output files.  The reason for this is that Spark expects many input &amp; output files: otherwise it wouldn’t be able to efficiently run on many machines and output data in parallel.  For this tutorial, we will merge all of this data into a single file, but in a production use-case we would be streaming data from HDFS during training.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge output data to single file</span>
<span class="n">mkdir</span> <span class="n">training_data</span>
<span class="n">cat</span> <span class="n">cartpole_discrete_training</span><span class="o">/</span><span class="n">part</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">training_data</span><span class="o">/</span><span class="n">cartpole_discrete_timeline</span><span class="o">.</span><span class="n">json</span>
<span class="n">cat</span> <span class="n">cartpole_discrete_eval</span><span class="o">/</span><span class="n">part</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">training_data</span><span class="o">/</span><span class="n">cartpole_discrete_timeline_eval</span><span class="o">.</span><span class="n">json</span>

<span class="c1"># Remove the output data folder</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">cartpole_discrete_training</span> <span class="n">cartpole_discrete_eval</span>
</pre></div>
</div>
<p>Now that all of our data has been grouped into consecutive pairs, we can run the normalization pipeline.</p>
</div>
<div class="section" id="step-3-create-the-normalization-parameters">
<h3>Step 3 - Create the normalization parameters<a class="headerlink" href="#step-3-create-the-normalization-parameters" title="Permalink to this headline">¶</a></h3>
<p>Data from production systems is often sparse, noisy and arbitrarily distributed. Literature has shown that neural networks learn faster and better when operating on batches of features that are normally distributed. Horizon includes a workflow that automatically analyzes the training dataset and determines the best transformation function and corresponding normalization parameters for each feature. We can run this workflow on the post timeline data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">create_normalization_metadata</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">sample_configs</span><span class="o">/</span><span class="n">discrete_action</span><span class="o">/</span><span class="n">dqn_example</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Now we can look at the normalization file.  It’s a JSON file where each key is a feature id and each value is a string-encoded JSON object describing the normalization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">training_data</span><span class="o">/</span><span class="n">state_features_norm</span><span class="o">.</span><span class="n">json</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">json</span><span class="o">.</span><span class="n">tool</span>

<span class="p">{</span>
    <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">feature_type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CONTINUOUS</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">mean</span><span class="se">\&quot;</span><span class="s2">:0.5675003528594971,</span><span class="se">\&quot;</span><span class="s2">stddev</span><span class="se">\&quot;</span><span class="s2">:1.0,</span><span class="se">\&quot;</span><span class="s2">min_value</span><span class="se">\&quot;</span><span class="s2">:-0.1467551738023758,</span><span class="se">\&quot;</span><span class="s2">max_value</span><span class="se">\&quot;</span><span class="s2">:2.1779561042785645}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">feature_type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CONTINUOUS</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">mean</span><span class="se">\&quot;</span><span class="s2">:0.42259514331817627,</span><span class="se">\&quot;</span><span class="s2">stddev</span><span class="se">\&quot;</span><span class="s2">:1.0,</span><span class="se">\&quot;</span><span class="s2">min_value</span><span class="se">\&quot;</span><span class="s2">:-1.3586808443069458,</span><span class="se">\&quot;</span><span class="s2">max_value</span><span class="se">\&quot;</span><span class="s2">:1.8529225587844849}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">feature_type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CONTINUOUS</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">mean</span><span class="se">\&quot;</span><span class="s2">:0.028220390900969505,</span><span class="se">\&quot;</span><span class="s2">stddev</span><span class="se">\&quot;</span><span class="s2">:1.0,</span><span class="se">\&quot;</span><span class="s2">min_value</span><span class="se">\&quot;</span><span class="s2">:-0.14581388235092163,</span><span class="se">\&quot;</span><span class="s2">max_value</span><span class="se">\&quot;</span><span class="s2">:0.19483095407485962}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">feature_type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CONTINUOUS</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">mean</span><span class="se">\&quot;</span><span class="s2">:0.02947876788675785,</span><span class="se">\&quot;</span><span class="s2">stddev</span><span class="se">\&quot;</span><span class="s2">:1.0,</span><span class="se">\&quot;</span><span class="s2">min_value</span><span class="se">\&quot;</span><span class="s2">:-2.194336175918579,</span><span class="se">\&quot;</span><span class="s2">max_value</span><span class="se">\&quot;</span><span class="s2">:2.164193868637085}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-train-model">
<h3>Step 4 - Train model<a class="headerlink" href="#step-4-train-model" title="Permalink to this headline">¶</a></h3>
<p>Now we are ready to train a model by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Store model outputs here</span>
<span class="n">mkdir</span> <span class="n">outputs</span>

<span class="n">python</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">dqn_workflow</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">sample_configs</span><span class="o">/</span><span class="n">discrete_action</span><span class="o">/</span><span class="n">dqn_example</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Note that, even in the OpenAI Gym case, we aren’t running the gym at this step.  We are taking a batch of data that we generated previously and training by looping over that data and interatively learning a better policy than the policy that generated the data.</p>
</div>
<div class="section" id="step-5-evaluate-the-model">
<h3>Step 5 - Evaluate the Model<a class="headerlink" href="#step-5-evaluate-the-model" title="Permalink to this headline">¶</a></h3>
<p>Now that we have trained a new policy on the offline <code class="docutils literal notranslate"><span class="pre">Cartpole-v0</span></code> data, we can try it out to see how it does:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">ml</span><span class="o">/</span><span class="n">rl</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">eval_cartpole</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">m</span> <span class="n">outputs</span><span class="o">/</span><span class="n">predictor</span><span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="step-6-visualize-results-via-tensorboard">
<h3>Step 6 - Visualize Results via Tensorboard<a class="headerlink" href="#step-6-visualize-results-via-tensorboard" title="Permalink to this headline">¶</a></h3>
<p>We can now view loss plots and CPE estimates in Tensorboard after running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span> <span class="n">outputs</span><span class="o">/</span>
</pre></div>
</div>
<p>at <a class="reference external" href="localhost:6006">localhost:6006</a>. When done viewing the results deactivate the virtualenv by typing <code class="docutils literal notranslate"><span class="pre">deactivate</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="distributed.html" class="btn btn-neutral float-right" title="Training a model across multiple GPUs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Facebook Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>